<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>å•†å“ç™»éŒ² | Salon Coeur</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: 'Noto Sans JP', sans-serif;
      background: #fefbf5;
      color: #444;
      padding: 15px;
      padding-bottom: 40px;
    }
    
    .header {
      text-align: center;
      margin-bottom: 20px;
    }
    
    .logo {
      font-size: 2em;
      margin-bottom: 10px;
    }
    
    h1 {
      color: #6a8f66;
      font-size: 1.6em;
      font-weight: 500;
      margin-bottom: 15px;
    }
    
    nav {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    nav a {
      padding: 8px 15px;
      background: #a3b18a;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      font-size: 0.85em;
      transition: 0.3s;
      white-space: nowrap;
    }
    
    nav a:active {
      transform: scale(0.98);
    }
    
    .btn-calendar {
      background: #5da3d5;
    }
    
    .btn-logout {
      background: #d9534f;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      padding: 25px 20px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    }
    
    .form-group {
      margin-bottom: 18px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #555;
      font-size: 0.95em;
    }
    
    .optional {
      font-size: 0.85em;
      color: #888;
      font-weight: normal;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #d9d6ce;
      border-radius: 8px;
      font-size: 16px;
      background: #fcfaf4;
      font-family: 'Noto Sans JP', sans-serif;
    }
    
    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    .form-group input[type="file"] {
      padding: 8px;
      background: white;
    }
    
    .preview-container {
      margin-top: 10px;
      text-align: center;
    }
    
    .preview-image {
      max-width: 200px;
      max-height: 200px;
      border-radius: 8px;
      display: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .price-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    
    .discount-info {
      margin-top: 8px;
      padding: 10px;
      background: #fff3cd;
      border-radius: 6px;
      font-size: 0.85em;
      color: #856404;
      display: none;
    }
    
    .add-new-btn {
      display: inline-block;
      margin-left: 10px;
      padding: 4px 10px;
      background: #5da3d5;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 0.8em;
      cursor: pointer;
      text-decoration: none;
      vertical-align: middle;
    }
    
    .add-new-btn:active {
      opacity: 0.8;
    }
    
    .manage-btn {
      display: inline-block;
      margin-left: 5px;
      padding: 4px 10px;
      background: #d9534f;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 0.8em;
      cursor: pointer;
      text-decoration: none;
      vertical-align: middle;
    }
    
    .manage-btn:active {
      opacity: 0.8;
    }
    
    .btn-submit {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #6a8f66 0%, #5a7d56 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1.05em;
      font-weight: 500;
      cursor: pointer;
      margin-top: 10px;
      font-family: 'Noto Sans JP', sans-serif;
      touch-action: manipulation;
    }
    
    .btn-submit:active {
      transform: scale(0.98);
    }
    
    footer {
      text-align: center;
      color: #888;
      margin-top: 30px;
      font-size: 0.85em;
    }
    
    /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      overflow-y: auto;
    }
    
    .modal-content {
      background-color: white;
      margin: 50px auto;
      padding: 25px 20px;
      border-radius: 12px;
      width: calc(100% - 40px);
      max-width: 400px;
    }
    
    .close {
      float: right;
      font-size: 28px;
      font-weight: bold;
      color: #aaa;
      cursor: pointer;
      line-height: 1;
    }
    
    .modal h2 {
      color: #6a8f66;
      margin-bottom: 20px;
      font-size: 1.2em;
      clear: both;
    }
    
    .modal-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .btn-modal-save, .btn-modal-cancel {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 0.95em;
      font-weight: 500;
      cursor: pointer;
      font-family: 'Noto Sans JP', sans-serif;
    }
    
    .btn-modal-save {
      background: #6a8f66;
      color: white;
    }
    
    .btn-modal-cancel {
      background: #999;
      color: white;
    }
    
    /* ç®¡ç†ãƒªã‚¹ãƒˆ */
    .manage-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      margin-bottom: 8px;
      background: #fcfaf4;
      border-radius: 8px;
      border: 1px solid #e8e4dc;
    }
    
    .manage-item-name {
      font-size: 0.95em;
      color: #333;
    }
    
    .btn-delete-item {
      padding: 6px 12px;
      background: #d9534f;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 0.85em;
      cursor: pointer;
      font-family: 'Noto Sans JP', sans-serif;
    }
    
    .btn-delete-item:active {
      opacity: 0.8;
    }
    
    @media (max-width: 480px) {
      .container {
        padding: 20px 18px;
      }
      
      h1 {
        font-size: 1.4em;
      }
      
      nav a {
        font-size: 0.8em;
        padding: 7px 12px;
      }
      
      .price-section {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">ğŸŒ¿</div>
    <h1>å•†å“ç™»éŒ²</h1>
  </div>
  
  <nav>
    <a href="/">ãƒ›ãƒ¼ãƒ </a>
    <a href="/admin">äºˆç´„ç®¡ç†</a>
    <a href="/admin/calendar" class="btn-calendar">ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç®¡ç†</a>
    <a href="/admin/products/list">å•†å“ä¸€è¦§ç®¡ç†</a>
    <a href="/shop">ã‚·ãƒ§ãƒƒãƒ—</a>
    <a href="/admin/logout" class="btn-logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
  </nav>

  <div class="container">
    <form id="productForm" enctype="multipart/form-data">
      <div class="form-group">
        <label>å•†å“ç”»åƒ *</label>
        <input type="file" id="image" name="image" accept="image/*" required onchange="previewImage(event)">
        <div class="preview-container">
          <img id="preview" class="preview-image" alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼">
        </div>
      </div>

      <div class="form-group">
        <label>å•†å“å *</label>
        <input type="text" id="product_name" name="product_name" placeholder="ä¾‹: ãƒ•ã‚§ã‚¤ã‚·ãƒ£ãƒ«ã‚¯ãƒªãƒ¼ãƒ " required>
      </div>

      <div class="form-group">
        <label>ãƒ–ãƒ©ãƒ³ãƒ‰ <span class="optional">(ä»»æ„)</span>
          <button type="button" class="add-new-btn" onclick="openBrandModal()">+ æ–°è¦è¿½åŠ </button>
          <button type="button" class="add-new-btn" style="background: #d9534f;" onclick="openBrandManageModal()">ç®¡ç†</button>
        </label>
        <select id="brand" name="brand">
          <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
        </select>
      </div>

      <div class="form-group">
        <label>ã‚«ãƒ†ã‚´ãƒª *
          <button type="button" class="add-new-btn" onclick="openCategoryModal()">+ æ–°è¦è¿½åŠ </button>
          <button type="button" class="add-new-btn" style="background: #d9534f;" onclick="openCategoryManageModal()">ç®¡ç†</button>
        </label>
        <select id="category" name="category" required>
          <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
        </select>
      </div>

      <div class="form-group">
        <label>ä¾¡æ ¼è¨­å®š</label>
        <div class="price-section">
          <div>
            <label style="font-size: 0.85em; margin-bottom: 5px;">è²©å£²ä¾¡æ ¼ (å††) *</label>
            <input type="number" id="price" name="price" min="0" step="0.01" placeholder="3500" required oninput="calculateDiscount()">
          </div>
          <div>
            <label style="font-size: 0.85em; margin-bottom: 5px;">å…ƒå€¤ (å††) <span class="optional">(ã‚»ãƒ¼ãƒ«æ™‚)</span></label>
            <input type="number" id="original_price" name="original_price" min="0" step="0.01" placeholder="5000" oninput="calculateDiscount()">
          </div>
        </div>
        <div id="discount-info" class="discount-info"></div>
      </div>

      <div class="form-group">
        <label>åœ¨åº«æ•° *</label>
        <input type="number" id="stock_quantity" name="stock_quantity" min="0" value="0" required>
      </div>

      <div class="form-group">
        <label>å•†å“èª¬æ˜ãƒ»å‚™è€ƒ <span class="optional">(ä»»æ„)</span></label>
        <textarea id="description" name="description" placeholder="å•†å“ã®èª¬æ˜ã‚„ç®¡ç†è€…ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›"></textarea>
      </div>

      <button type="submit" class="btn-submit">å•†å“ã‚’ç™»éŒ²</button>
    </form>
  </div>

  <!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="categoryModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeCategoryModal()">&times;</span>
      <h2>ã‚«ãƒ†ã‚´ãƒªãƒ¼è¿½åŠ </h2>
      <div class="form-group">
        <label>ã‚«ãƒ†ã‚´ãƒªãƒ¼å *</label>
        <input type="text" id="new-category-name" placeholder="ä¾‹: ãƒœãƒ‡ã‚£ã‚±ã‚¢">
      </div>
      <div class="modal-buttons">
        <button type="button" class="btn-modal-cancel" onclick="closeCategoryModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button type="button" class="btn-modal-save" onclick="addCategory()">è¿½åŠ </button>
      </div>
    </div>
  </div>

  <!-- ãƒ–ãƒ©ãƒ³ãƒ‰è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="brandModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeBrandModal()">&times;</span>
      <h2>ãƒ–ãƒ©ãƒ³ãƒ‰è¿½åŠ </h2>
      <div class="form-group">
        <label>ãƒ–ãƒ©ãƒ³ãƒ‰å *</label>
        <input type="text" id="new-brand-name" placeholder="ä¾‹: è³‡ç”Ÿå ‚">
      </div>
      <div class="modal-buttons">
        <button type="button" class="btn-modal-cancel" onclick="closeBrandModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button type="button" class="btn-modal-save" onclick="addBrand()">è¿½åŠ </button>
      </div>
    </div>
  </div>

  <!-- ãƒ–ãƒ©ãƒ³ãƒ‰ç®¡ç†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="brandManageModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeBrandManageModal()">&times;</span>
      <h2>ãƒ–ãƒ©ãƒ³ãƒ‰ç®¡ç†</h2>
      <div id="brand-list" style="max-height: 400px; overflow-y: auto;">
        <div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>
      </div>
    </div>
  </div>

  <!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼ç®¡ç†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="categoryManageModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeCategoryManageModal()">&times;</span>
      <h2>ã‚«ãƒ†ã‚´ãƒªãƒ¼ç®¡ç†</h2>
      <div id="category-list" style="max-height: 400px; overflow-y: auto;">
        <div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>
      </div>
    </div>
  </div>

  <footer>Â© 2025 Salon Coeur</footer>

  <script>
    let categories = [];
    let brands = [];

    async function loadCategories() {
      try {
        const response = await fetch('/categories');
        const data = await response.json();
        categories = data.categories || [];
        
        const select = document.getElementById('category');
        select.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>' +
          categories.map(cat => `<option value="${cat.category_name}">${cat.category_name}</option>`).join('');
      } catch (error) {
        console.error('ã‚«ãƒ†ã‚´ãƒªãƒ¼èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
      }
    }

    async function loadBrands() {
      try {
        const response = await fetch('/brands');
        const data = await response.json();
        brands = data.brands || [];
        
        const select = document.getElementById('brand');
        select.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>' +
          brands.map(brand => `<option value="${brand.brand_name}">${brand.brand_name}</option>`).join('');
      } catch (error) {
        console.error('ãƒ–ãƒ©ãƒ³ãƒ‰èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
      }
    }

    function calculateDiscount() {
      const price = parseFloat(document.getElementById('price').value) || 0;
      const originalPrice = parseFloat(document.getElementById('original_price').value) || 0;
      const discountInfo = document.getElementById('discount-info');
      
      if (originalPrice > 0 && originalPrice > price) {
        const discountPercent = Math.round(((originalPrice - price) / originalPrice) * 100);
        const savedAmount = originalPrice - price;
        discountInfo.textContent = `ğŸ’° ${discountPercent}% OFFï¼ˆÂ¥${savedAmount.toLocaleString()}ãŠå¾—ï¼‰`;
        discountInfo.style.display = 'block';
      } else {
        discountInfo.style.display = 'none';
      }
    }

    function previewImage(event) {
      const file = event.target.files[0];
      const preview = document.getElementById('preview');
      
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          preview.src = e.target.result;
          preview.style.display = 'block';
        }
        reader.readAsDataURL(file);
      }
    }

    function openCategoryModal() {
      document.getElementById('categoryModal').style.display = 'block';
      document.getElementById('new-category-name').value = '';
    }

    function closeCategoryModal() {
      document.getElementById('categoryModal').style.display = 'none';
    }

    function openCategoryManageModal() {
      document.getElementById('categoryManageModal').style.display = 'block';
      loadCategoryManageList();
    }

    function closeCategoryManageModal() {
      document.getElementById('categoryManageModal').style.display = 'none';
    }

    async function loadCategoryManageList() {
      const container = document.getElementById('category-list');
      container.innerHTML = '<div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>';
      
      await loadCategories();
      
      if (categories.length === 0) {
        container.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">ã‚«ãƒ†ã‚´ãƒªãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“</div>';
        return;
      }
      
      const html = categories.map(cat => `
        <div class="manage-item">
          <span class="manage-item-name">${cat.category_name}</span>
          <button class="btn-delete-item" onclick="deleteCategory(${cat.id}, '${cat.category_name}')">å‰Šé™¤</button>
        </div>
      `).join('');
      
      container.innerHTML = html;
    }

    async function deleteCategory(id, name) {
      if (!confirm(`ã€Œ${name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nâ€»ã“ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å•†å“ã«ã¯å½±éŸ¿ã—ã¾ã›ã‚“`)) return;

      try {
        const response = await fetch(`/admin/categories/${id}`, {
          method: 'DELETE'
        });

        if (response.ok) {
          alert('ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
          await loadCategoryManageList();
          await loadCategories();
        } else if (response.status === 401) {
          alert('ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒåˆ‡ã‚Œã¾ã—ãŸã€‚å†åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚');
          window.location.href = '/admin/login';
        } else {
          const data = await response.json();
          alert('ã‚¨ãƒ©ãƒ¼: ' + (data.error || 'ã‚«ãƒ†ã‚´ãƒªãƒ¼å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ'));
        }
      } catch (error) {
        console.error('Error:', error);
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
      }
    }

    async function addCategory() {
      const name = document.getElementById('new-category-name').value.trim();
      if (!name) {
        alert('ã‚«ãƒ†ã‚´ãƒªãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }

      try {
        const response = await fetch('/admin/categories', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ category_name: name, display_order: categories.length })
        });

        if (response.ok) {
          alert('ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’è¿½åŠ ã—ã¾ã—ãŸ');
          closeCategoryModal();
          await loadCategories();
          document.getElementById('category').value = name;
        } else {
          const data = await response.json();
          alert('ã‚¨ãƒ©ãƒ¼: ' + (data.error || 'ã‚«ãƒ†ã‚´ãƒªãƒ¼è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ'));
        }
      } catch (error) {
        console.error('Error:', error);
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
      }
    }

    function openBrandModal() {
      document.getElementById('brandModal').style.display = 'block';
      document.getElementById('new-brand-name').value = '';
    }

    function closeBrandModal() {
      document.getElementById('brandModal').style.display = 'none';
    }

    function openBrandManageModal() {
      document.getElementById('brandManageModal').style.display = 'block';
      loadBrandManageList();
    }

    function closeBrandManageModal() {
      document.getElementById('brandManageModal').style.display = 'none';
    }

    async function loadBrandManageList() {
      const container = document.getElementById('brand-list');
      container.innerHTML = '<div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>';
      
      await loadBrands();
      
      if (brands.length === 0) {
        container.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">ãƒ–ãƒ©ãƒ³ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“</div>';
        return;
      }
      
      const html = brands.map(brand => `
        <div class="manage-item">
          <span class="manage-item-name">${brand.brand_name}</span>
          <button class="btn-delete-item" onclick="deleteBrand(${brand.id}, '${brand.brand_name}')">å‰Šé™¤</button>
        </div>
      `).join('');
      
      container.innerHTML = html;
    }

    async function deleteBrand(id, name) {
      if (!confirm(`ã€Œ${name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nâ€»ã“ã®ãƒ–ãƒ©ãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å•†å“ã«ã¯å½±éŸ¿ã—ã¾ã›ã‚“`)) return;

      try {
        const response = await fetch(`/admin/brands/${id}`, {
          method: 'DELETE'
        });

        if (response.ok) {
          alert('ãƒ–ãƒ©ãƒ³ãƒ‰ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
          await loadBrandManageList();
          await loadBrands();
        } else if (response.status === 401) {
          alert('ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒåˆ‡ã‚Œã¾ã—ãŸã€‚å†åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚');
          window.location.href = '/admin/login';
        } else {
          const data = await response.json();
          alert('ã‚¨ãƒ©ãƒ¼: ' + (data.error || 'ãƒ–ãƒ©ãƒ³ãƒ‰å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ'));
        }
      } catch (error) {
        console.error('Error:', error);
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
      }
    }

    async function addBrand() {
      const name = document.getElementById('new-brand-name').value.trim();
      if (!name) {
        alert('ãƒ–ãƒ©ãƒ³ãƒ‰åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }

      try {
        const response = await fetch('/admin/brands', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ brand_name: name })
        });

        if (response.ok) {
          alert('ãƒ–ãƒ©ãƒ³ãƒ‰ã‚’è¿½åŠ ã—ã¾ã—ãŸ');
          closeBrandModal();
          await loadBrands();
          document.getElementById('brand').value = name;
        } else {
          const data = await response.json();
          alert('ã‚¨ãƒ©ãƒ¼: ' + (data.error || 'ãƒ–ãƒ©ãƒ³ãƒ‰è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ'));
        }
      } catch (error) {
        console.error('Error:', error);
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
      }
    }

    document.getElementById('productForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = new FormData();
      const imageFile = document.getElementById('image').files[0];
      
      if (!imageFile) {
        alert('ç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
      }

      const reader = new FileReader();
      reader.onload = async function(e) {
        const base64Image = e.target.result;
        
        formData.append('product_name', document.getElementById('product_name').value);
        formData.append('price', document.getElementById('price').value);
        
        const originalPrice = document.getElementById('original_price').value;
        if (originalPrice) {
          formData.append('original_price', originalPrice);
        }
        
        const brand = document.getElementById('brand').value;
        if (brand) {
          formData.append('brand', brand);
        }
        
        formData.append('category', document.getElementById('category').value);
        formData.append('stock_quantity', document.getElementById('stock_quantity').value);
        formData.append('description', document.getElementById('description').value);
        formData.append('image_data', base64Image);

        try {
          const response = await fetch('/admin/products/add', {
            method: 'POST',
            body: formData
          });

          const result = await response.json();
          
          if (response.ok) {
            alert('å•†å“ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼\nã‚·ãƒ§ãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã—ã¾ã™ã€‚');
            window.location.href = '/shop';
          } else if (response.status === 401) {
            alert('ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒåˆ‡ã‚Œã¾ã—ãŸã€‚å†åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚');
            window.location.href = '/admin/login';
          } else {
            alert('ã‚¨ãƒ©ãƒ¼: ' + (result.error || 'å•†å“ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ'));
          }
        } catch (error) {
          console.error('Error:', error);
          alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
        }
      };

      reader.readAsDataURL(imageFile);
    });

    document.addEventListener('DOMContentLoaded', () => {
      loadCategories();
      loadBrands();
    });

    window.onclick = function(event) {
      const categoryModal = document.getElementById('categoryModal');
      const brandModal = document.getElementById('brandModal');
      const categoryManageModal = document.getElementById('categoryManageModal');
      const brandManageModal = document.getElementById('brandManageModal');
      
      if (event.target == categoryModal) closeCategoryModal();
      if (event.target == brandModal) closeBrandModal();
      if (event.target == categoryManageModal) closeCategoryManageModal();
      if (event.target == brandManageModal) closeBrandManageModal();
    }
  </script>
</body>
</html>