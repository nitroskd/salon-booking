<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>å•†å“ä¸€è¦§ | Salon Coeur</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Noto Sans JP', sans-serif;
      background: #fefbf5;
      color: #444;
      padding: 15px;
      padding-bottom: 40px;
    }

    .header {
      text-align: center;
      margin-bottom: 25px;
    }

    .logo {
      font-size: 2em;
      margin-bottom: 10px;
    }

    h1 {
      color: #6a8f66;
      font-size: 1.6em;
      font-weight: 500;
      margin-bottom: 8px;
    }

    .subtitle {
      color: #888;
      font-size: 0.9em;
      font-weight: 300;
    }

    .back-link {
      display: inline-block;
      margin: 15px auto 20px;
      padding: 10px 20px;
      background: #a3b18a;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      font-size: 0.9em;
      transition: 0.3s;
    }

    .back-link:active {
      transform: scale(0.98);
    }

    .filter-section {
      margin: 20px 0;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .filter-label {
      font-size: 0.85em;
      color: #666;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .filter-buttons {
      display: flex;
      gap: 10px;
      padding: 5px 0;
      white-space: nowrap;
      margin-bottom: 15px;
    }

    .filter-btn {
      padding: 10px 20px;
      background: #ffffff;
      border: 2px solid #d9d6ce;
      border-radius: 20px;
      cursor: pointer;
      transition: 0.3s;
      font-size: 0.9em;
      color: #666;
      font-family: 'Noto Sans JP', sans-serif;
      flex-shrink: 0;
      touch-action: manipulation;
    }

    .filter-btn.active {
      background: #a3b18a;
      color: white;
      border-color: #a3b18a;
    }

    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }

    .product-card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
      transition: 0.3s;
      position: relative;
    }

    .product-card:active {
      transform: scale(0.98);
    }

    .sale-badge {
      position: absolute;
      top: 8px;
      right: 8px;
      background: #ff4757;
      color: white;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.75em;
      font-weight: 600;
      z-index: 1;
      box-shadow: 0 2px 8px rgba(255, 71, 87, 0.3);
    }

    .product-image {
      width: 100%;
      height: 160px;
      background: linear-gradient(135deg, #e8e4dc 0%, #d9d6ce 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5em;
      color: #a3b18a;
    }

    .product-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .product-info {
      padding: 15px;
    }

    .product-badges {
      display: flex;
      gap: 5px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }

    .product-category {
      display: inline-block;
      padding: 3px 10px;
      background: #f0ede5;
      color: #6a8f66;
      border-radius: 10px;
      font-size: 0.75em;
    }

    .product-brand {
      display: inline-block;
      padding: 3px 10px;
      background: #e8f5e9;
      color: #4caf50;
      border-radius: 10px;
      font-size: 0.75em;
    }

    .product-name {
      font-size: 1em;
      font-weight: 500;
      color: #333;
      margin: 8px 0;
      line-height: 1.4;
    }

    .product-description {
      color: #777;
      font-size: 0.85em;
      line-height: 1.5;
      margin: 8px 0;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .product-price-section {
      margin: 10px 0 5px;
    }

    .original-price {
      font-size: 0.9em;
      color: #999;
      text-decoration: line-through;
      margin-bottom: 3px;
    }

    .product-price {
      font-size: 1.3em;
      color: #6a8f66;
      font-weight: 600;
    }

    .sale-price {
      color: #ff4757;
    }

    .stock-info {
      font-size: 0.8em;
      color: #999;
    }

    .stock-info.in-stock {
      color: #6a8f66;
    }

    .stock-info.low-stock {
      color: #d4a574;
    }

    .stock-info.out-of-stock {
      color: #c66;
    }

    .loading, .error, .no-products {
      text-align: center;
      padding: 40px 20px;
      color: #999;
      font-size: 1em;
    }

    footer {
      text-align: center;
      margin-top: 30px;
      color: #888;
      font-size: 0.85em;
    }

    @media (max-width: 480px) {
      .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 12px;
      }

      .product-image {
        height: 140px;
        font-size: 2em;
      }

      .product-info {
        padding: 12px;
      }
      
      .contact-section {
        padding: 18px;
      }
      
      .contact-text {
        font-size: 0.85em;
      }
      
      .contact-links {
        flex-direction: column;
      }
      
      .contact-btn {
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">ğŸŒ¿</div>
    <h1>å•†å“ä¸€è¦§</h1>
    <p class="subtitle">ã‚µãƒ­ãƒ³å³é¸å•†å“<br>
    ã”æ¥åº—ã®ãŠå®¢æ§˜ã®ã¿ã¸ã®è²©å£²ã¨ãªã‚Šã¾ã™ ã€‚</p>
    <a href="/home" class="back-link">â† ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>
  </div>

  <!-- å•ã„åˆã‚ã›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <div class="contact-section">
    <p class="contact-text">
      å•†å“ã«å¯¾ã™ã‚‹å•ã„åˆã‚ã›ã¯Instagramã®DM <br>
     ã‚‚ã—ãã¯å…¬å¼LINEã«ã¦ãŠå•ã„åˆã‚ã›ãã ã•ã„âœ¨
    </p>
    <div class="contact-links">
      <a href="https://www.instagram.com/parafuse.kagoshima.maho?igsh=MXNxdGh3NmozY2tidw==" target="_blank" rel="noopener noreferrer" class="contact-btn instagram">
        <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
          <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/>
        </svg>
        Instagram
      </a>
      <a href="https://line.me/R/ti/p/@027hzoow" target="_blank" rel="noopener noreferrer" class="contact-btn line">
        <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
          <path d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346 0 .627.285.627.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/>
        </svg>
        LINE
      </a>
    </div>
  </div>

  <div class="filter-section">
    <div class="filter-label">ã‚«ãƒ†ã‚´ãƒªãƒ¼</div>
    <div class="filter-buttons" id="category-filters">
      <button class="filter-btn active" data-category="all">ã™ã¹ã¦</button>
    </div>
    
    <div class="filter-label" style="margin-top: 15px;">ãƒ–ãƒ©ãƒ³ãƒ‰</div>
    <div class="filter-buttons" id="brand-filters">
      <button class="filter-btn active" data-brand="all">ã™ã¹ã¦</button>
    </div>
  </div>

  <div id="products-container">
    <div class="loading">å•†å“ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
  </div>

  <footer>
    <p>Â© 2025 Salon Coeur</p>
  </footer>

  <script>
    let allProducts = [];
    let categories = [];
    let brands = [];
    let currentCategory = 'all';
    let currentBrand = 'all';

    async function fetchCategories() {
      try {
        const response = await fetch('/categories');
        const data = await response.json();
        categories = data.categories || [];
        renderCategoryFilters();
      } catch (error) {
        console.error('ã‚«ãƒ†ã‚´ãƒªãƒ¼å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      }
    }

    async function fetchBrands() {
      try {
        const response = await fetch('/brands');
        const data = await response.json();
        brands = data.brands || [];
        renderBrandFilters();
      } catch (error) {
        console.error('ãƒ–ãƒ©ãƒ³ãƒ‰å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      }
    }

    async function fetchProducts() {
      try {
        const response = await fetch('/products');
        const data = await response.json();
        allProducts = data.products || [];
        displayProducts(allProducts);
      } catch (error) {
        document.getElementById('products-container').innerHTML = 
          '<div class="error">å•†å“ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>';
      }
    }

    function renderCategoryFilters() {
      const container = document.getElementById('category-filters');
      const allBtn = '<button class="filter-btn active" data-category="all">ã™ã¹ã¦</button>';
      const categoryBtns = categories.map(cat => 
        `<button class="filter-btn" data-category="${cat.category_name}">${cat.category_name}</button>`
      ).join('');
      container.innerHTML = allBtn + categoryBtns;
      
      container.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          filterByCategory(btn.dataset.category);
        });
      });
    }

    function renderBrandFilters() {
      const container = document.getElementById('brand-filters');
      const allBtn = '<button class="filter-btn active" data-brand="all">ã™ã¹ã¦</button>';
      const brandBtns = brands.map(brand => 
        `<button class="filter-btn" data-brand="${brand.brand_name}">${brand.brand_name}</button>`
      ).join('');
      container.innerHTML = allBtn + brandBtns;
      
      container.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          filterByBrand(btn.dataset.brand);
        });
      });
    }

    function calculateDiscount(originalPrice, salePrice) {
      if (!originalPrice || originalPrice <= salePrice) return 0;
      return Math.round(((originalPrice - salePrice) / originalPrice) * 100);
    }

    function displayProducts(products) {
      const container = document.getElementById('products-container');
      
      if (!products || products.length === 0) {
        container.innerHTML = '<div class="no-products">å•†å“ãŒã‚ã‚Šã¾ã›ã‚“</div>';
        return;
      }

      const html = '<div class="products-grid">' + 
        products.map(product => {
          const stockClass = product.stock_quantity > 10 ? 'in-stock' : 
                           product.stock_quantity > 0 ? 'low-stock' : 'out-of-stock';
          const stockText = product.stock_quantity > 0 ? 
                          `åœ¨åº«: ${product.stock_quantity}å€‹` : 'åœ¨åº«åˆ‡ã‚Œ';
          
          const imageHtml = product.image_data ? 
            `<img src="${product.image_data}" alt="${product.product_name}">` :
            'ğŸŒ¿';
          
          const hasDiscount = product.original_price && product.original_price > product.price;
          const discountPercent = hasDiscount ? calculateDiscount(product.original_price, product.price) : 0;
          
          const saleBadge = hasDiscount ? `<div class="sale-badge">${discountPercent}% OFF</div>` : '';
          
          const priceHtml = hasDiscount ? `
            <div class="original-price">Â¥${Number(product.original_price).toLocaleString()}</div>
            <div class="product-price sale-price">Â¥${Number(product.price).toLocaleString()}</div>
          ` : `
            <div class="product-price">Â¥${Number(product.price).toLocaleString()}</div>
          `;
          
          const badges = [];
          if (product.category) {
            badges.push(`<span class="product-category">${product.category}</span>`);
          }
          if (product.brand) {
            badges.push(`<span class="product-brand">${product.brand}</span>`);
          }
          
          return `
            <div class="product-card">
              ${saleBadge}
              <div class="product-image">${imageHtml}</div>
              <div class="product-info">
                <div class="product-badges">${badges.join('')}</div>
                <div class="product-name">${product.product_name}</div>
                <div class="product-description">${product.description || ''}</div>
                <div class="product-price-section">${priceHtml}</div>
                <div class="stock-info ${stockClass}">${stockText}</div>
              </div>
            </div>
          `;
        }).join('') + '</div>';
      
      container.innerHTML = html;
    }

    function filterByCategory(category) {
      currentCategory = category;
      document.querySelectorAll('#category-filters .filter-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.category === category) {
          btn.classList.add('active');
        }
      });
      applyFilters();
    }

    function filterByBrand(brand) {
      currentBrand = brand;
      document.querySelectorAll('#brand-filters .filter-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.brand === brand) {
          btn.classList.add('active');
        }
      });
      applyFilters();
    }

    function applyFilters() {
      let filtered = allProducts;
      
      if (currentCategory !== 'all') {
        filtered = filtered.filter(p => p.category === currentCategory);
      }
      
      if (currentBrand !== 'all') {
        filtered = filtered.filter(p => p.brand === currentBrand);
      }
      
      displayProducts(filtered);
    }

    document.addEventListener('DOMContentLoaded', async () => {
      await fetchCategories();
      await fetchBrands();
      await fetchProducts();
    });
  </script>
</body>
</html>